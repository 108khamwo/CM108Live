<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CM108 Hybrid Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; background: #000; font-family: 'Prompt', sans-serif; overflow: hidden; }

        /* --- LOBBY --- */
        #lobby { position: absolute; inset: 0; z-index: 100; background: #0f0f0f; display: flex; flex-direction: column; padding: 20px; overflow-y: auto; text-align: center; }
        h1 { color: #ff3b30; margin: 10px 0 20px; font-size: 26px; font-weight: 700; }
        .label { color: #666; font-size: 13px; margin: 15px 0 10px; border-bottom: 1px solid #333; padding-bottom: 5px; text-align: left; }
        
        /* 3 MODES GRID */
        .mode-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .m-btn { background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 15px 5px; color: #888; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .m-btn.active { background: #ff3b30; border-color: #ff3b30; color: white; }
        .m-btn span:first-child { font-size: 20px; }
        .m-btn small { font-size: 9px; opacity: 0.8; }
        
        .cam-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .c-card { background: linear-gradient(145deg, #222, #1b1b1b); border: 1px solid #333; border-radius: 12px; padding: 20px 0; cursor: pointer; }
        .c-card strong { display: block; font-size: 18px; color: white; margin-bottom: 5px; }

        /* --- LIVE VIEW --- */
        #live-view { display: none; position: fixed; inset: 0; background: #000; z-index: 50; }
        iframe { width: 100%; height: 100%; border: none; }

        /* --- FLOATING UI (‡∏Ç‡∏ß‡∏≤‡∏Å‡∏•‡∏≤‡∏á) --- */
        .side-panel {
            position: absolute; right: 12px; top: 45%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 15px; align-items: center;
            background: rgba(0,0,0,0.6); padding: 18px 8px; border-radius: 30px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
            z-index: 60;
        }

        /* Zoom Slider */
        .zoom-box { height: 120px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        input[type=range][orient=vertical] {
            writing-mode: bt-lr; -webkit-appearance: slider-vertical;
            width: 8px; height: 100%; cursor: pointer; accent-color: #ff3b30;
        }

        .btn-circle {
            width: 44px; height: 44px; border-radius: 50%; border: none;
            background: rgba(255,255,255,0.15); color: white; font-size: 20px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .btn-home { background: #ff3b30; font-size: 11px; font-weight: bold; }

        /* Message Popup */
        #msg-toast {
            position: absolute; top: 15%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; background: rgba(0,0,0,0.9); border-left: 5px solid #ff3b30;
            color: white; padding: 15px; border-radius: 8px; text-align: center;
            display: none; z-index: 2000;
        }

        /* Black Screen */
        #curtain { position: fixed; inset: 0; background: #000; z-index: 999; display: none; align-items: center; justify-content: center; flex-direction: column; color: #444; }
    </style>
</head>
<body>

    <div id="lobby">
        <h1>CM108 LIVE</h1>
        
        <div class="label">1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</div>
        <div class="mode-grid">
            <div class="m-btn active" id="m-hq" onclick="setMode('hq')">
                <span>üíé</span><strong>‡∏ä‡∏±‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©</strong><small>1080p 60fps</small>
            </div>
            <div class="m-btn" id="m-safe" onclick="setMode('safe')">
                <span>üõ°Ô∏è</span><strong>‡πÄ‡∏ô‡πâ‡∏ô‡∏•‡∏∑‡πà‡∏ô</strong><small>720p 30fps</small>
            </div>
            <div class="m-btn" id="m-auto" onclick="setMode('auto')">
                <span>ü§ñ</span><strong>‡∏≠‡∏≠‡πÇ‡∏ï‡πâ</strong><small>‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡πá‡∏ï</small>
            </div>
        </div>

        <div class="label">2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</div>
        <div class="cam-grid">
            <div class="c-card" onclick="start('CM108_Cam1')"><strong>CAM 01</strong><small style="color:#888">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å</small></div>
            <div class="c-card" onclick="start('CM108_Cam2')"><strong>CAM 02</strong><small style="color:#888">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á</small></div>
            <div class="c-card" onclick="start('CM108_Cam3')"><strong>CAM 03</strong><small style="color:#888">‡∏°‡∏∏‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á</small></div>
            <div class="c-card" onclick="start('CM108_Cam4')"><strong>CAM 04</strong><small style="color:#888">‡πÇ‡∏î‡∏£‡∏ô/‡∏≠‡∏∑‡πà‡∏ô‡πÜ</small></div>
        </div>
        <p style="font-size:11px; color:#444; margin-top:30px;">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤ Green Room ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î START</p>
    </div>

    <div id="live-view">
        <iframe id="vid" allow="camera;microphone;fullscreen;display-capture;autoplay;flashlight"></iframe>

        <div class="side-panel">
            <div class="zoom-box">
                <small style="color:#888; font-size:9px;">ZOOM</small>
                <input type="range" orient="vertical" min="1" max="8" step="0.1" value="1" oninput="doZoom(this.value)">
            </div>
            <button class="btn-circle" onclick="sendToNinja('cycleVideo')">üîÑ</button>
            <button class="btn-circle" onclick="toggleBlack()">üåô</button>
            <button class="btn-circle btn-home" onclick="location.reload()">HOME</button>
        </div>

        <div id="msg-toast">
            <div style="font-size:10px; color:#aaa; margin-bottom:5px;">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å MCR:</div>
            <span id="msg-text" style="font-size:20px; font-weight:bold;">--</span>
        </div>
    </div>

    <div id="curtain" onclick="toggleBlack()">
        <div style="font-size:50px; margin-bottom:15px;">üé•</div>
        <div style="color:#fff; font-size:18px;">‡πÇ‡∏´‡∏°‡∏î‡∏û‡∏±‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</div>
        <div style="font-size:12px; margin-top:10px;">(‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏¢‡∏±‡∏á‡∏™‡πà‡∏á‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≠)</div>
    </div>

    <script>
        let mode = 'hq';

        function setMode(m) {
            mode = m;
            document.querySelectorAll('.m-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('m-' + m).classList.add('active');
        }

        function start(id) {
            let p = "";
            if(mode === 'hq') p = "&width=1920&height=1080&videobitrate=8000&framerate=60&quality=0";
            else if(mode === 'safe') p = "&width=1280&height=720&bitrate=2500&framerate=30&buffer=2000&denoise=1";
            else p = "&quality=1&meshcast";

            // ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà &autostart ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏° START ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÜ
            // ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà &clean ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏ü‡∏∑‡∏≠‡∏á Ninja ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏£‡∏ö
            let url = "https://vdo.ninja/?push=" + id + "&room=CM108_NewsRoom" + p + 
                      "&viewchat=1&api=1&label=" + id + "&flashlight=1";

            document.getElementById('vid').src = url;
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('live-view').style.display = 'block';

            window.addEventListener('message', function(e) {
                if (e.data.action === 'chat' || e.data.msg === 'chat') {
                    const txt = e.data.value || e.data.content;
                    if(txt) {
                        const toast = document.getElementById('msg-toast');
                        document.getElementById('msg-text').innerText = txt;
                        toast.style.display = 'block';
                        if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
                        setTimeout(() => { toast.style.display = 'none'; }, 10000);
                    }
                }
            });
        }

        function doZoom(val) {
            // ‡∏™‡∏±‡πà‡∏á Hardware Zoom ‡∏ú‡πà‡∏≤‡∏ô API ‡∏Ç‡∏≠‡∏á Ninja
            document.getElementById('vid').contentWindow.postMessage({
                "target": "video",
                "type": "applyConstraints",
                "constraints": { "advanced": [{ "zoom": parseFloat(val) }] }
            }, '*');
        }

        function sendToNinja(cmd) {
            document.getElementById('vid').contentWindow.postMessage({"function": cmd}, '*');
        }

        function toggleBlack() {
            const c = document.getElementById('curtain');
            c.style.display = (c.style.display === 'flex') ? 'none' : 'flex';
        }
    </script>
</body>
</html>
