<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CM108 Live">
    
    <title>CM108 Mobile Unit</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; background: #000; font-family: 'Prompt', sans-serif; overflow: hidden; }

        /* --- LOBBY --- */
        #lobby { 
            position: absolute; inset: 0; z-index: 100; background: #111; 
            display: flex; flex-direction: column; padding: 20px; text-align: center; overflow-y: auto; 
        }
        h1 { color: #007aff; margin-bottom: 10px; font-size: 26px; }
        .label { color: #888; font-size: 14px; margin: 15px 0 10px; border-bottom: 1px solid #333; padding-bottom: 5px; text-align: left; }
        
        .mode-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .m-btn { 
            background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 15px 5px; 
            color: #888; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; 
        }
        .m-btn.active { background: #007aff; color: white; border-color: #007aff; }
        .m-btn span { font-weight: bold; font-size: 14px; }
        .m-btn small { font-size: 10px; opacity: 0.8; }
        
        .cam-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        .c-card { 
            background: linear-gradient(145deg, #222, #1b1b1b); border: 1px solid #333; 
            border-radius: 12px; padding: 25px 0; cursor: pointer; color: white; transition: 0.2s;
        }
        .c-card:active { transform: scale(0.98); border-color: #007aff; }
        .c-card strong { display: block; font-size: 18px; margin-bottom: 5px; }

        /* --- LIVE VIEW --- */
        #live-view { display: none; position: fixed; inset: 0; background: #000; z-index: 50; }
        iframe { width: 100%; height: 100%; border: none; }

        /* --- STATUS BAR --- */
        .status-bar {
            position: fixed !important; top: 15px; left: 15px; z-index: 999999 !important;
            background: rgba(0,0,0,0.6); padding: 8px 12px; border-radius: 20px;
            color: white; font-size: 12px; display: flex; gap: 15px; align-items: center;
            backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1);
            pointer-events: auto; cursor: pointer; font-weight: 500;
        }
        .status-item { display: flex; align-items: center; gap: 5px; }
        .text-good { color: #34c759; }
        .text-warn { color: #ffcc00; }
        .text-bad { color: #ff3b30; }

        /* --- CONTROL --- */
        .side-ctrl {
            position: fixed !important; right: 15px; top: 50%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 15px; align-items: center;
            background: rgba(0,0,0,0.6); padding: 15px 10px; border-radius: 35px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
            z-index: 999999 !important; pointer-events: auto;
        }

        .btn-act { 
            width: 45px; height: 45px; border-radius: 50%; border: none; 
            background: rgba(255,255,255,0.15); color: white; font-size: 20px; 
            cursor: pointer; display: flex; align-items: center; justify-content: center; 
        }
        .btn-act:active { background: white; color: black; }
        .btn-home { background: #007aff; font-size: 11px; font-weight: bold; }

        /* --- MESSAGE POPUP --- */
        #msg-toast {
            position: fixed !important; top: 20%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; max-width: 400px; background: rgba(0,0,0,0.95); 
            border-left: 5px solid #007aff; 
            color: white; padding: 15px 20px; border-radius: 8px; text-align: center;
            display: none; z-index: 2147483647 !important; pointer-events: auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .toast-close {
            position: absolute; top: 5px; right: 10px; color: #888; font-size: 16px; 
            background: none; border: none; cursor: pointer; padding: 5px;
        }
        @keyframes slideDown { from {transform: translate(-50%, -20px); opacity:0;} to {transform: translate(-50%, 0); opacity:1;} }

        /* --- BLACK SCREEN --- */
        #ghost { 
            position: fixed !important; inset: 0; background: #000; z-index: 2147483647 !important; display: none; 
            align-items: center; justify-content: center; flex-direction: column; color: #444; 
        }
    </style>
</head>
<body>

    <div id="lobby">
        <h1>CM108 LIVE</h1>
        
        <div class="label">1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</div>
        <div class="mode-grid">
            <div class="m-btn active" id="m-hq" onclick="setMode('hq')"><span>‡∏ä‡∏±‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©</span><small>1080p 60fps</small></div>
            <div class="m-btn" id="m-safe" onclick="setMode('safe')"><span>‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£</span><small>720p 30fps</small></div>
            <div class="m-btn" id="m-auto" onclick="setMode('auto')"><span>‡∏≠‡∏≠‡πÇ‡∏ï‡πâ</span><small>‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡πá‡∏ï</small></div>
        </div>
        
        <div class="label">2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á</div>
        <div class="cam-grid">
            <div class="c-card" onclick="start('CM108_Cam1')"><strong>CAM 01</strong><small style="color:#888">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å</small></div>
            <div class="c-card" onclick="start('CM108_Cam2')"><strong>CAM 02</strong><small style="color:#888">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á</small></div>
            <div class="c-card" onclick="start('CM108_Cam3')"><strong>CAM 03</strong><small style="color:#888">‡∏°‡∏∏‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á</small></div>
            <div class="c-card" onclick="start('CM108_Cam4')"><strong>CAM 04</strong><small style="color:#888">‡πÇ‡∏î‡∏£‡∏ô</small></div>
        </div>
        
        <p style="font-size:11px; color:#555; margin-top:30px;">
            ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏û<br>‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡∏Ñ‡πå ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° START üü¢
        </p>
    </div>

    <div id="live-view">
        <iframe id="vid" allow="camera;microphone;fullscreen;display-capture;autoplay"></iframe>

        <!-- ‡∏Å‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠) -->
        <div class="status-bar" id="status-bar" style="display: none;" onclick="showToast('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö!')">
            <div class="status-item"><span id="net-icon">üü¢</span> <span id="net-text">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì...</span></div>
        </div>

        <div class="side-ctrl">
            <button class="btn-act" onclick="toggleFullScreen()" title="‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠">‚õ∂</button>
            <button class="btn-act" onclick="toggleGhost()" title="‡∏û‡∏±‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠">üåô</button>
            <button class="btn-act btn-home" onclick="location.reload()" title="‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å">HOME</button>
        </div>

        <div id="msg-toast">
            <button class="toast-close" onclick="closeToast()">‚úï</button>
            <div style="font-size:10px; color:#aaa; margin-bottom:5px;">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏®‡∏π‡∏ô‡∏¢‡πå (MCR):</div>
            <span id="msg-text" style="font-size:20px; font-weight:bold; color:#fff;">--</span>
        </div>
    </div>

    <div id="ghost" onclick="toggleGhost()">
        <div style="font-size:50px; margin-bottom:15px;">üé•</div>
        <h2 style="color:#fff; margin:0;">‡∏û‡∏±‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</h2>
        <p style="font-size:12px; margin-top:5px;">(‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡∏π‡πà)</p>
        <div style="margin-top:20px; font-size:11px; border:1px solid #333; padding:5px 15px; border-radius:20px;">‡πÅ‡∏ï‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏∏‡∏Å</div>
    </div>

    <script>
        let mode = 'hq';

        function setMode(m) {
            mode = m;
            document.querySelectorAll('.m-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('m-' + m).classList.add('active');
        }

        function start(id) {
            let p = "";
            if(mode === 'hq') p = "&width=1920&height=1080&videobitrate=8000&framerate=60";
            else if(mode === 'safe') p = "&width=1280&height=720&bitrate=2500&framerate=30";
            else p = "&quality=1";

            let url = "https://vdo.ninja/?push=" + id + "&room=CM108_NewsRoom" + p + 
                      "&clean=0&viewchat=1&api=1&label=" + id + "&select";

            document.getElementById('vid').src = url;
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('live-view').style.display = 'block';
            
            document.getElementById('status-bar').style.display = 'flex';
            initMonitor();
            requestWakeLock();

            // === ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏£‡∏∏‡πà‡∏ô‡πÅ‡∏Å‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á 2 ‡∏ä‡∏±‡πâ‡∏ô) ===
            window.addEventListener('message', function(e) {
                try {
                    let data = e.data;
                    
                    // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÅ‡∏Å‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏≠‡∏Å‡∏™‡∏∏‡∏î
                    if (typeof data === 'string') {
                        try { data = JSON.parse(data); } catch(err) {}
                    }
                    if (!data || typeof data !== 'object') return;

                    // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÅ‡∏Å‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô‡πÉ‡∏ô (VDO.Ninja ‡∏ä‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏ô data.data ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô String ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ)
                    if (data.data && typeof data.data === 'string') {
                        try { data.data = JSON.parse(data.data); } catch(err) {}
                    }

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ payload ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏á‡πà‡∏≤‡∏¢‡πÜ
                    let payload = (data.data && typeof data.data === 'object') ? data.data : data;

                    // ‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á‡∏£‡∏±‡∏ß‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà
                    let actionStr = String(payload.action || payload.type || "").toLowerCase();
                    if (actionStr === 'stats' || actionStr === 'mic-volume' || actionStr === 'video-bitrate') return;

                    let txt = "";

                    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏°‡∏≤ ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô payload.gotchat.msg)
                    if (payload.gotchat && payload.gotchat.msg) {
                        txt = payload.gotchat.msg;
                    } else if (actionStr.includes('chat') || actionStr.includes('msg')) {
                        txt = payload.msg || payload.message || payload.text || payload.chat;
                    }

                    // ‡∏ñ‡πâ‡∏≤‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß...
                    if (txt && typeof txt === 'string') {
                        let cleanTxt = txt;
                        
                        // ‡∏´‡∏±‡πà‡∏ô‡∏ó‡∏¥‡πâ‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° Tag <span ‡∏´‡∏£‡∏∑‡∏≠ <br> ‡∏´‡∏£‡∏∑‡∏≠ <b><i ‡∏ó‡∏µ‡πà Ninja ‡∏ä‡∏≠‡∏ö‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏™‡πà‡∏á‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢
                        // (‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏£‡∏∞‡∏´‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ)
                        cleanTxt = cleanTxt.split(/<span/i)[0];
                        cleanTxt = cleanTxt.split(/<b><i/i)[0];
                        cleanTxt = cleanTxt.split(/<br\s*\/?>/i)[0];
                        
                        // ‡∏ñ‡∏≠‡∏î Tag ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏Å‡∏≠‡∏µ‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà "555" ‡πÄ‡∏û‡∏µ‡∏¢‡∏ß‡πÜ
                        cleanTxt = cleanTxt.replace(/<[^>]*>?/gm, '').trim();

                        if (cleanTxt !== "") {
                            showToast(cleanTxt);
                        }
                    }
                } catch(error) {
                    console.error("Chat parsing error:", error);
                }
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        let toastTimeout;
        function showToast(textToShow) {
            const toast = document.getElementById('msg-toast');
            const msgText = document.getElementById('msg-text');
            
            msgText.innerText = textToShow;
            toast.style.display = 'block';
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            toast.style.animation = 'none';
            toast.offsetHeight; 
            toast.style.animation = 'slideDown 0.3s';
            
            // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏á‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡πÜ ‡∏Å‡∏±‡∏ô ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô)
            if(toastTimeout) clearTimeout(toastTimeout);
            
            // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            toastTimeout = setTimeout(() => { toast.style.display = 'none'; }, 10000);
        }

        function closeToast() {
            document.getElementById('msg-toast').style.display = 'none';
        }

        function toggleGhost() {
            let g = document.getElementById('ghost');
            g.style.display = (g.style.display === 'flex') ? 'none' : 'flex';
        }

        function toggleFullScreen() {
            const doc = window.document;
            const docEl = doc.documentElement;
            const requestFullScreen = docEl.requestFullscreen || docEl.webkitRequestFullscreen || docEl.mozRequestFullScreen || docEl.msRequestFullscreen;
            const cancelFullScreen = doc.exitFullscreen || doc.webkitExitFullscreen || doc.mozCancelFullScreen || doc.msExitFullscreen;

            if (!doc.fullscreenElement && !doc.webkitFullscreenElement && !doc.mozFullScreenElement && !doc.msFullscreenElement) {
                if (requestFullScreen) {
                    requestFullScreen.call(docEl).catch(err => { alert(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡πÑ‡∏î‡πâ: ${err.message}`); });
                } else {
                    alert("iPhone ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠:\n1. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡πÅ‡∏ä‡∏£‡πå' ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Safari\n2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏Æ‡∏°' (Add to Home Screen)\n3. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏Æ‡∏°");
                }
            } else {
                if (cancelFullScreen) cancelFullScreen.call(doc);
            }
        }

        let wakeLock = null;
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                }
            } catch (err) {}
        }
        document.addEventListener('visibilitychange', () => {
            if (wakeLock !== null && document.visibilityState === 'visible') requestWakeLock();
        });

        function initMonitor() {
            function updateNetwork() {
                const netText = document.getElementById('net-text');
                const netIcon = document.getElementById('net-icon');
                
                if (navigator.onLine) {
                    if (navigator.connection) {
                        const type = navigator.connection.effectiveType; 
                        const dl = navigator.connection.downlink || 0;
                        
                        if (type === '4g' || dl >= 3) {
                            netText.innerText = '‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏£‡∏á)';
                            netText.className = 'text-good';
                            netIcon.innerText = 'üü¢';
                        } else if (type === '3g' || dl >= 1) {
                            netText.innerText = '‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡∏û‡∏≠‡πÉ‡∏ä‡πâ)';
                            netText.className = 'text-warn';
                            netIcon.innerText = 'üü°';
                        } else {
                            netText.innerText = '‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡πà‡∏≠‡∏ô (‡πÄ‡∏ô‡πá‡∏ï‡∏ä‡πâ‡∏≤)';
                            netText.className = 'text-bad';
                            netIcon.innerText = 'üî¥';
                        }
                    } else {
                        netText.innerText = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
                        netText.className = 'text-good';
                        netIcon.innerText = 'üü¢';
                    }
                } else {
                    netText.innerText = '‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)';
                    netText.className = 'text-bad';
                    netIcon.innerText = '‚ùå';
                }
            }
            updateNetwork();
            window.addEventListener('online', updateNetwork);
            window.addEventListener('offline', updateNetwork);
            if (navigator.connection) navigator.connection.addEventListener('change', updateNetwork);
        }
    </script>
</body>
</html>
