<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CM108 Mobile Unit</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ff3b30; --bg: #000; --panel: rgba(20, 20, 20, 0.9); }
        body { margin: 0; padding: 0; background: var(--bg); color: white; font-family: 'Prompt', sans-serif; overflow: hidden; height: 100vh; width: 100vw; }
        
        /* --- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á (Lobby) --- */
        #lobby { position: fixed; inset: 0; z-index: 20; background: #000; display: flex; flex-direction: column; padding: 20px; overflow-y: auto; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: var(--primary); margin: 0; font-size: 28px; text-transform: uppercase; }
        .header p { color: #666; font-size: 12px; margin-top: 5px; }

        /* ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î */
        .section-title { font-size: 14px; color: #888; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .mode-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .mode-btn { background: #1a1a1a; border: 1px solid #333; color: #aaa; padding: 15px 5px; border-radius: 8px; font-size: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; transition: 0.2s; }
        .mode-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 0 15px rgba(255, 59, 48, 0.4); }
        .mode-icon { font-size: 20px; }

        /* ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á */
        .cam-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .cam-card { background: linear-gradient(145deg, #1a1a1a, #222); border: 1px solid #333; border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; position: relative; overflow: hidden; }
        .cam-card:active { transform: scale(0.98); background: #333; }
        .cam-card strong { display: block; font-size: 24px; margin-bottom: 5px; }
        .cam-card span { font-size: 12px; color: #666; }

        /* --- ‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏™‡∏î (Live) --- */
        #live-view { display: none; position: fixed; inset: 0; z-index: 10; }
        iframe { width: 100%; height: 100%; border: none; object-fit: cover; }

        /* UI ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Overlay) */
        .overlay-top { position: absolute; top: 0; left: 0; right: 0; padding: 15px; display: flex; justify-content: space-between; align-items: flex-start; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); pointer-events: none; }
        .status-badge { background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); padding: 5px 12px; border-radius: 20px; font-size: 12px; display: flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.1); color: #0f0; }
        .status-dot { width: 8px; height: 8px; background: #0f0; border-radius: 50%; box-shadow: 0 0 8px #0f0; }
        
        /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ */
        #msg-popup { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%;
            background: rgba(0, 0, 0, 0.85); border-left: 5px solid var(--primary); color: white; padding: 20px; 
            border-radius: 8px; font-size: 18px; text-align: center; display: none; z-index: 100;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: translate(-50%, -40%) scale(0.9); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }

        /* ‡πÅ‡∏ñ‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
        .controls-bar { 
            position: absolute; bottom: 0; left: 0; right: 0; 
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); 
            padding: 20px; display: flex; flex-direction: column; gap: 15px; 
            align-items: center; pointer-events: none;
        }
        
        /* ‡∏™‡πÑ‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ã‡∏π‡∏° */
        .zoom-container { width: 80%; pointer-events: auto; display: flex; align-items: center; gap: 10px; }
        input[type=range] { flex-grow: 1; height: 4px; background: #555; border-radius: 2px; -webkit-appearance: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: white; border-radius: 50%; box-shadow: 0 0 10px rgba(0,0,0,0.5); }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î */
        .btn-row { display: flex; gap: 15px; pointer-events: auto; }
        .circle-btn { width: 50px; height: 50px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.5); color: white; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); transition: 0.2s; }
        .circle-btn:active { background: white; color: black; }
        .stop-btn { background: var(--primary); border: none; font-weight: bold; width: auto; padding: 0 25px; border-radius: 30px; }

        /* ‡πÇ‡∏´‡∏°‡∏î‡∏û‡∏±‡∏Å‡∏à‡∏≠ (Black Screen) */
        #black-curtain { position: fixed; inset: 0; background: black; z-index: 9999; display: none; align-items: center; justify-content: center; flex-direction: column; color: #444; }
        #black-curtain .tap-hint { border: 1px solid #333; padding: 10px 20px; border-radius: 20px; margin-top: 20px; font-size: 12px; }
    </style>
</head>
<body>

    <div id="lobby">
        <div class="header">
            <h1>CM108 LIVE</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏†‡∏≤‡∏Ñ‡∏™‡∏ô‡∏≤‡∏° | Mobile Unit v2.0</p>
        </div>

        <div class="section-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á (Transmission Mode)</div>
        <div class="mode-grid">
            <div class="mode-btn active" onclick="setMode('hq', this)">
                <div class="mode-icon">üíé</div>
                <div>‡∏ä‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î<br>(HQ)</div>
            </div>
            <div class="mode-btn" onclick="setMode('stable', this)">
                <div class="mode-icon">üõ°Ô∏è</div>
                <div>‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏™‡∏∏‡∏î<br>(Stable)</div>
            </div>
            <div class="mode-btn" onclick="setMode('auto', this)">
                <div class="mode-icon">ü§ñ</div>
                <div>‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞<br>(Auto)</div>
            </div>
        </div>

        <div class="section-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Å‡∏•‡πâ‡∏≠‡∏á (Camera ID)</div>
        <div class="cam-grid">
            <div class="cam-card" onclick="startStream('CM108_Cam1')"><strong>01</strong><span>‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å</span></div>
            <div class="cam-card" onclick="startStream('CM108_Cam2')"><strong>02</strong><span>‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á</span></div>
            <div class="cam-card" onclick="startStream('CM108_Cam3')"><strong>03</strong><span>‡∏°‡∏∏‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á</span></div>
            <div class="cam-card" onclick="startStream('CM108_Cam4')"><strong>04</strong><span>‡πÇ‡∏î‡∏£‡∏ô/‡∏û‡∏¥‡πÄ‡∏®‡∏©</span></div>
        </div>
    </div>

    <div id="live-view">
        <iframe id="vid-frame" allow="camera;microphone;fullscreen;display-capture;autoplay;zoom"></iframe>
        
        <div class="overlay-top">
            <div class="status-badge">
                <div class="status-dot"></div>
                <span id="conn-status">ONLINE 1080p</span>
            </div>
            <div class="status-badge" style="background:rgba(255,59,48,0.2); border-color:var(--primary); color:var(--primary);">
                REC ‚óè
            </div>
        </div>

        <div id="msg-popup">
            <div style="font-size:12px; opacity:0.7; margin-bottom:5px;">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏®‡∏π‡∏ô‡∏¢‡πå:</div>
            <span id="msg-content">--</span>
        </div>

        <div class="controls-bar">
            <div class="zoom-container">
                <span style="font-size:12px">1x</span>
                <input type="range" min="1" max="5" step="0.1" value="1" id="zoomSlider" oninput="applyZoom(this.value)">
                <span style="font-size:12px">5x</span>
            </div>
            
            <div class="btn-row">
                <button class="circle-btn" onclick="toggleBlackScreen()">üåô</button> <button class="circle-btn" onclick="sendCommand('cycleVideo')">üîÑ</button> <button class="circle-btn" onclick="sendCommand('muteAudio')">üéôÔ∏è</button> <button class="circle-btn stop-btn" onclick="location.reload()">‚èπ ‡∏´‡∏¢‡∏∏‡∏î</button>
            </div>
        </div>
    </div>

    <div id="black-curtain" onclick="toggleBlackScreen()">
        <div style="font-size:40px; color:#222;">üé•</div>
        <div style="color:#333; margin-top:10px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á...</div>
        <div class="tap-hint">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</div>
    </div>

    <script>
        let currentMode = 'hq'; // default

        function setMode(mode, el) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function startStream(camId) {
            let params = "";
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î
            if (currentMode === 'hq') params = "&width=1920&height=1080&videobitrate=8000&framerate=60&quality=0";
            else if (currentMode === 'stable') params = "&width=1280&height=720&framerate=30&bitrate=2500&buffer=2000&quality=1";
            else if (currentMode === 'auto') params = "&quality=1&meshcast"; // Auto bitrate

            // ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö (‡∏ã‡∏π‡∏°‡πÑ‡∏î‡πâ, ‡πÅ‡∏ä‡∏ó‡πÄ‡∏î‡πâ‡∏á, ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ñ‡∏•‡∏µ‡∏ô, ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)
            let url = "https://vdo.ninja/?push=" + camId + "&room=CM108_NewsRoom" + params + 
                      "&chat=1&viewchat=1&clean=1&hidelinks=1&noheader=1&autostart&label=" + camId + 
                      "&select&zoom=1"; // &zoom=1 ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ hardware zoom

            document.getElementById('vid-frame').src = url;
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('live-view').style.display = 'block';

            // ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            window.addEventListener('message', (e) => {
                if (e.data.msg === 'chat' || e.data.action === 'chat') {
                    showPopup(e.data.content || e.data.value);
                }
            });
        }

        function showPopup(text) {
            let p = document.getElementById('msg-popup');
            document.getElementById('msg-content').innerText = text;
            p.style.display = 'block';
            setTimeout(() => { p.style.display = 'none'; }, 8000); // ‡πÇ‡∏ä‡∏ß‡πå 8 ‡∏ß‡∏¥
        }

        function sendCommand(cmd) {
            document.getElementById('vid-frame').contentWindow.postMessage({"function": cmd}, '*');
        }

        function toggleBlackScreen() {
            let bs = document.getElementById('black-curtain');
            bs.style.display = (bs.style.display === 'flex') ? 'none' : 'flex';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡∏π‡∏° (‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ VDO.Ninja ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ native constraints ‡∏ñ‡πâ‡∏≤ iframe ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï)
        function applyZoom(val) {
            // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ã‡∏π‡∏°‡πÑ‡∏õ‡∏ó‡∏µ‡πà iframe (VDO.Ninja API ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö zoom ‡∏ú‡πà‡∏≤‡∏ô postMessage ‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô)
            // ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ URL param &zoom=val ‡πÅ‡∏ï‡πà‡∏°‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î
            // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Native UI ‡∏Ç‡∏≠‡∏á VDO.Ninja ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ ‡πÅ‡∏ï‡πà‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ Custom UI
            // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏•‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á zoom
             document.getElementById('vid-frame').contentWindow.postMessage({"target": "video", "type": "zoom", "value": val}, '*');
        }
    </script>
</body>
</html>
