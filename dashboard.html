<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>CM108 MCR PRO (Native)</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Prompt', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* Header */
        header { 
            height: 50px; background: #111; border-bottom: 2px solid #ff3b30; 
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px; 
        }
        .logo { font-size: 18px; font-weight: bold; letter-spacing: 1px; }
        .logo span { color: #ff3b30; }
        .status { font-size: 12px; color: #888; display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .dot { width: 8px; height: 8px; background: #0f0; border-radius: 50%; box-shadow: 0 0 5px #0f0; }

        /* Main View */
        main { flex-grow: 1; position: relative; background: #000; }
        iframe { width: 100%; height: 100%; border: none; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏° */
        #start-overlay { 
            position: fixed; inset: 0; background: #000; z-index: 999; 
            display: flex; justify-content: center; align-items: center; 
        }
        .start-btn { 
            background: #ff3b30; color: white; font-size: 20px; padding: 15px 40px; 
            border-radius: 50px; border: none; cursor: pointer; font-weight: bold;
            box-shadow: 0 0 20px rgba(255,59,48,0.4); transition: transform 0.2s;
        }
        .start-btn:active { transform: scale(0.95); }

        /* --- MESSAGE POPUP (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ù‡∏±‡πà‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå MCR) --- */
        #msg-toast {
            position: fixed !important; top: 15%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; max-width: 600px; background: rgba(0,0,0,0.95); 
            border-left: 6px solid #0f0; 
            color: white; padding: 20px 30px; border-radius: 10px; text-align: center;
            display: none; z-index: 2147483647 !important; pointer-events: auto;
            box-shadow: 0 10px 30px rgba(0,255,0,0.2);
        }
        .toast-close {
            position: absolute; top: 10px; right: 15px; color: #888; font-size: 20px; 
            background: none; border: none; cursor: pointer; padding: 5px;
        }
        .toast-close:hover { color: #fff; }
        @keyframes slideDownMCR { 
            0% { transform: translate(-50%, -30px); opacity: 0; } 
            100% { transform: translate(-50%, 0); opacity: 1; } 
        }
    </style>
</head>
<body>

    <div id="start-overlay">
        <button class="start-btn" onclick="startSystem()">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</button>
    </div>

    <header>
        <div class="logo">CM108 <span>MASTER CONTROL</span></div>
        <div class="status" onclick="showToast('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏®‡∏π‡∏ô‡∏¢‡πå MCR', '‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô')">
            <span class="dot"></span> ONLINE SYSTEM
        </div>
    </header>

    <main>
        <iframe id="mcr" allow="camera;microphone;fullscreen;display-capture;autoplay"></iframe>

        <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡πâ‡∏á -->
        <div id="msg-toast">
            <button class="toast-close" onclick="closeToast()">‚úï</button>
            <div id="sender-title" style="font-size:14px; color:#0f0; margin-bottom:8px; font-weight:bold;">üì• ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏†‡∏≤‡∏Ñ‡∏™‡∏ô‡∏≤‡∏°:</div>
            <span id="msg-text" style="font-size:32px; font-weight:bold; color:#fff;">--</span>
        </div>
    </main>

    <script>
        function startSystem() {
            document.getElementById('start-overlay').style.display = 'none';
            
            // ‡πÉ‡∏ä‡πâ &api=1 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            let url = "https://vdo.ninja/?director=CM108_NewsRoom&autoadd=1&quality=0&clean=0&api=1";
            document.getElementById('mcr').src = url;

            // === ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ) ===
            window.addEventListener('message', function(e) {
                if (!e.data) return;

                let rawStr = typeof e.data === 'string' ? e.data : JSON.stringify(e.data);
                if (rawStr.includes('"stats"') || rawStr.includes('"video-bitrate"') || rawStr.includes('"mic-volume"')) return;
                
                let rawMsg = null;
                let senderName = "‡∏ó‡∏µ‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏†‡∏≤‡∏Ñ‡∏™‡∏ô‡∏≤‡∏°";

                function extractMsg(item) {
                    if (typeof item === 'string') {
                        if (item.trim().startsWith('{')) {
                            try { item = JSON.parse(item); } catch(err) { return; }
                        } else return;
                    }
                    if (typeof item !== 'object' || item === null) return;

                    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                    if (item.action === 'chat' || item.type === 'chat' || item.gotchat) {
                        if (item.msg) rawMsg = item.msg;
                        else if (item.chat) rawMsg = item.chat;
                        else if (item.value) rawMsg = item.value;
                        else if (item.gotchat && item.gotchat.msg) rawMsg = item.gotchat.msg;

                        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏™‡πà‡∏á
                        if (item.from) senderName = item.from;
                        else if (item.label) senderName = item.label;
                        return;
                    }

                    if (item.gotchat && item.gotchat.msg) {
                        rawMsg = item.gotchat.msg;
                        return;
                    }

                    for (let key in item) {
                        if (typeof item[key] === 'object') extractMsg(item[key]);
                    }
                }

                try {
                    extractMsg(e.data);

                    if (rawMsg && typeof rawMsg === 'string') {
                        let cleanTxt = rawMsg.split('<')[0].trim();
                        if (cleanTxt === "") {
                            cleanTxt = rawMsg.replace(/<[^>]*>?/gm, '').trim();
                        }

                        if (cleanTxt !== "") {
                            showToast(cleanTxt, senderName);
                        }
                    }
                } catch(error) {
                    console.error("Chat parsing error:", error);
                }
            });
        }

        let toastTimeout;
        function showToast(textToShow, sender = "‡∏ó‡∏µ‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏†‡∏≤‡∏Ñ‡∏™‡∏ô‡∏≤‡∏°") {
            const toast = document.getElementById('msg-toast');
            const msgText = document.getElementById('msg-text');
            const senderTitle = document.getElementById('sender-title');
            
            // ‡πÇ‡∏ä‡∏ß‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤
            senderTitle.innerText = `üì• ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏à‡∏≤‡∏Å [ ${sender} ]:`;
            msgText.innerText = textToShow;
            
            toast.style.display = 'block';
            toast.style.animation = 'none';
            toast.offsetHeight; 
            toast.style.animation = 'slideDownMCR 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28)';
            
            playAlertSound();
            
            if(toastTimeout) clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => { toast.style.display = 'none'; }, 15000);
        }

        function closeToast() {
            document.getElementById('msg-toast').style.display = 'none';
        }

        function playAlertSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(880, ctx.currentTime); 
                gain.gain.setValueAtTime(0.3, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.6);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.6);
            } catch(e) {}
        }
    </script>
</body>
</html>
